<script>
let vagasTotais = 28;
let vagasRestantes = 28;
let quantidade = 1;

let precos = {
    PIX: 155,
    Credito: 165
};

let links = {
    PIX: "trilheiros.roomt@gmail.com",
    Credito: "https://www.mercadopago.com.br/checkout/v1/payment/redirect/COLE_SEU_LINK_AQUI"
};

function atualizar() {
    const tipo = document.getElementById("pagamento").value;
    const btn = document.getElementById("pagamentoBtn");
    const alerta = document.getElementById("alerta");
    const vagasSpan = document.getElementById("vagas");

    // Atualiza contadores
    document.getElementById("qtd").innerText = quantidade;
    vagasSpan.innerText = vagasRestantes - quantidade;

    // Se acabou vaga
    if ((vagasRestantes - quantidade) <= 0) {
        btn.style.display = "none";
        alerta.innerText = "âŒ Vagas esgotadas! Entre em contato com o Jonatas.";
        vagasSpan.innerText = 0;
        return;
    }

    // Aviso de Ãºltimas vagas
    if ((vagasRestantes - quantidade) <= 5) {
        alerta.innerText = "âš ï¸ Ãšltimas vagas disponÃ­veis!";
    } else {
        alerta.innerText = "";
    }

    // PIX (mÃºltiplas vagas)
    if (tipo === "PIX") {
        const total = precos.PIX * quantidade;
        document.getElementById("total").innerText = "Total R$ " + total;

        btn.style.display = "block";
        btn.innerText = "Copiar chave PIX";
        btn.className = "btn pixbtn";
        btn.href = "javascript:copiarPix()";
    }

    // CARTÃƒO (somente 1 vaga)
    if (tipo === "Credito") {
        document.getElementById("total").innerText =
            "Valor por vaga: R$ " + precos.Credito;

        if (quantidade > 1) {
            btn.style.display = "none";
            alerta.innerText =
              "ðŸ’³ Para pagar mais de 1 vaga no cartÃ£o, procure o Jonatas para gerar um novo link individual.";
        } else {
            btn.style.display = "block";
            btn.innerText = "Copiar link do cartÃ£o ðŸ’³";
            btn.className = "btn creditobtn";
            btn.href = "javascript:copiarLinkCartao()";
        }
    }
}

function aumentar() {
    if (quantidade < vagasRestantes) {
        quantidade++;
        atualizar();
    }
}

function diminuir() {
    if (quantidade > 1) {
        quantidade--;
        atualizar();
    }
}

function copiarPix() {
    navigator.clipboard.writeText(links.PIX);
    alert("Chave PIX copiada! âœ…");
}

function copiarLinkCartao() {
    navigator.clipboard.writeText(links.Credito);
    alert("Link do cartÃ£o copiado! Cole no navegador ðŸ’³");
}

function enviarWhats() {
    const nome = document.getElementById("nome").value;
    if (!nome) {
        alert("Digite seu nome completo.");
        return;
    }

    // CONFIRMAÃ‡ÃƒO FINAL â†’ trava vaga
    vagasRestantes -= quantidade;
    quantidade = 1;
    atualizar();

    const msg =
      `OlÃ¡, meu nome Ã© ${nome}. ` +
      `Acabei de reservar vaga(s) para o passeio no Complexo TurÃ­stico CarimÃ£. ` +
      `Segue o comprovante de pagamento.`;

    window.open(
      "https://wa.me/5566996926174?text=" + encodeURIComponent(msg),
      "_blank"
    );
}
</script>
